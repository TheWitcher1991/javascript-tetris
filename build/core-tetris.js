!function(e){var t={};function i(n){if(t[n])return t[n].exports;var l=t[n]={i:n,l:!1,exports:{}};return e[n].call(l.exports,l,l.exports,i),l.l=!0,l.exports}i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var l in e)i.d(n,l,function(t){return e[t]}.bind(null,l));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,i){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}i.r(t);var r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.score=0,this.lines=19,this.points={1:40,2:100,3:300,4:1200},this.playfield=this.createPlayfield(),this.activePiece=this.createPiece(),this.nextPiece=this.createPiece()}var t,i,n;return t=e,(i=[{key:"getState",value:function(){for(var e=this.createPlayfield(),t=this.activePiece,i=t.x,n=t.y,l=t.blocks,r=0;r<this.playfield.length;r++){e[r]=[];for(var s=0;s<this.playfield[r].length;s++)e[r][s]=this.playfield[r][s]}for(var o=0;o<l.length;o++)for(var c=0;c<l[o].length;c++)l[o][c]&&(e[n+o][i+c]=l[o][c]);return{score:this.score,level:this.level,lines:this.lines,nextPiece:this.nextPiece,playfield:e}}},{key:"createPlayfield",value:function(){for(var e=[],t=0;t<20;t++){e[t]=[];for(var i=0;i<10;i++)e[t][i]=0}return e}},{key:"createPiece",value:function(){var e={};switch("IJLOSTZ"[Math.floor(7*Math.random())]){case"I":e.blocks=[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]];break;case"J":e.blocks=[[0,0,0],[2,2,2],[0,0,2]];break;case"L":e.blocks=[[0,0,0],[3,3,3],[4,0,0]];break;case"O":e.blocks=[[0,0,0,0],[0,4,4,0],[0,4,4,0],[0,0,0,0]];break;case"S":e.blocks=[[0,0,0],[0,5,5],[5,5,0]];break;case"T":e.blocks=[[0,0,0],[6,6,6],[0,6,0]];break;case"Z":e.blocks=[[0,0,0],[7,7,0],[0,7,7]];break;default:throw new Error("Неизвестная фигура")}return e.x=Math.floor((10-e.blocks[0].length)/2),e.y=0,e}},{key:"movePieceLeft",value:function(){this.activePiece.x-=1,this.hasCollision()&&(this.activePiece.x+=1)}},{key:"movePieceRight",value:function(){this.activePiece.x+=1,this.hasCollision()&&(this.activePiece.x-=1)}},{key:"movePieceDown",value:function(){if(this.activePiece.y+=1,this.hasCollision()){this.activePiece.y-=1,this.lockPiece();var e=this.clearLines();this.updateScore(e),this.updatePiece()}}},{key:"rotatePiece",value:function(){this.rotateBlocks(),this.hasCollision()&&this.rotateBlocks(!1)}},{key:"rotateBlocks",value:function(){for(var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.activePiece.blocks,i=t.length,n=Math.floor(i/2),l=i-1,r=0;r<n;r++)for(var s=r;s<l-r;s++){var o=t[r][s];e?(t[r][s]=t[l-s][r],t[l-s][r]=t[l-r][l-s],t[l-r][l-s]=t[s][l-r],t[s][l-r]=o):(t[r][s]=t[s][l-r],t[s][l-r]=t[l-r][l-s],t[l-r][l-s]=t[l-s][r],t[l-s][r]=o)}}},{key:"hasCollision",value:function(){for(var e=this.playfield,t=this.activePiece,i=t.x,n=t.y,l=t.blocks,r=0;r<l.length;r++)for(var s=0;s<l[r].length;s++)if(l[r][s]&&(void 0===e[n+r]||void 0===e[n+r][i+s]||e[n+r][i+s]))return!0;return!1}},{key:"lockPiece",value:function(){for(var e=this.playfield,t=this.activePiece,i=t.x,n=t.y,l=t.blocks,r=0;r<l.length;r++)for(var s=0;s<l[r].length;s++)l[r][s]&&(e[n+r][i+s]=l[r][s])}},{key:"clearLines",value:function(){for(var e=[],t=19;t>=0;t--){for(var i=0,n=0;n<10;n++)this.playfield[t][n]&&(i+=1);if(0===i)break;i<10||10===i&&e.unshift(t)}for(var l=0,r=e;l<r.length;l++){var s=r[l];this.playfield.splice(s,1),this.playfield.unshift(new Array(10).fill(0))}return e.length}},{key:"updateScore",value:function(e){e>0&&(this.score=this.points[e]*(this.level+1),this.lines+=e)}},{key:"updatePiece",value:function(){this.activePiece=this.nextPiece,this.nextPiece=this.createPiece()}},{key:"level",get:function(){return Math.floor(.1*this.lines)}}])&&l(t.prototype,i),n&&l(t,n),e}();function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}r.extend=r.prototype.extend=function(e,t){if("object"===n(e)&&"object"===n(t))for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};var c=function(){function e(t,i,n,l,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.element=t,this.width=i,this.height=n,this.rows=l,this.colums=r,this.colors={1:"cyan",2:"blue",3:"orange",4:"yellow",5:"green",6:"purpure",7:"red"},this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.height,this.ctx=this.canvas.getContext("2d"),this.playfieldBorderWidth=4,this.playfieldX=this.playfieldBorderWidth,this.playfieldY=this.playfieldBorderWidth,this.playfieldWidth=2*this.width/3,this.playfieldHeight=this.height,this.playfieldInnerWidth=this.playfieldWidth-2*this.playfieldBorderWidth,this.playfieldInnerHeight=this.playfieldHeight-2*this.playfieldBorderWidth,this.blockWidth=this.playfieldInnerWidth/r,this.blockHeight=this.playfieldInnerHeight/l,this.panelX=this.playfieldWidth+10,this.panelY=0,this.panelWidth=this.width/2,this.panelHeight=this.height,this.element.appendChild(this.canvas)}var t,i,n;return t=e,(i=[{key:"renderMainScreen",value:function(e){this.clearScreen(),this.renderPlayfield(e),this.renderPanel(e)}},{key:"renderStartScreen",value:function(){this.ctx.fillStyle="white",this.ctx.font='18px "Press Start 2P"',this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText("Press ENTER to Start",this.width/2,this.height/2)}},{key:"renderPauseScreen",value:function(){this.ctx.fillStyle="rgba(0, 0, 0, 0, 0.75)",this.ctx.fillRect(0,0,this.width,this.height),this.ctx.fillStyle="white",this.ctx.font='18px "Press Start 2P"',this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText("Press ENTER to Resume",this.width/2,this.height/2)}},{key:"renderEndScreen",value:function(e){var t=e.score;this.clearScreen(),this.ctx.fillStyle="white",this.ctx.font='18px "Press Start 2P"',this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText("Game Over",this.width/2,this.height/2-48),this.ctx.fillText("Score: ".concat(t),this.width/2,this.height/2)}},{key:"clearScreen",value:function(){this.ctx.clearRect(0,0,this.width,this.height)}},{key:"renderPlayfield",value:function(e){for(var t=e.playfield,i=0;i<t.length;i++)for(var n=t[i],l=0;l<n.length;l++){var r=n[l];r&&this.renderBlock(this.playfieldX+l*this.blockWidth,this.playfieldY+i*this.blockHeight,this.blockWidth,this.blockHeight,this.colors[r])}this.ctx.strokeStyle="white",this.ctx.lineWidth=this.playfieldBorderWidth,this.ctx.strokeRect(0,0,this.playfieldInnerWidth,this.playfieldInnerHeight)}},{key:"renderPanel",value:function(e){var t=e.level,i=e.score,n=e.lines,l=e.nextPiece;this.ctx.textAlign="start",this.ctx.textBaseline="top",this.ctx.fillStyle="white",this.ctx.font='14px "Press Start 2P"',this.ctx.fillText("Score: ".concat(i),this.panelX,this.panelY+0),this.ctx.fillText("Lines: ".concat(n),this.panelX,this.panelY+24),this.ctx.fillText("Level: ".concat(t),this.panelX,this.panelY+48),this.ctx.fillText("Next",this.panelX,this.panelY+96);for(var r=0;r<l.blocks.length;r++)for(var s=0;s<l.blocks[r].length;s++){var o=l.blocks[r][s];o&&this.renderBlock(this.panelX+s*this.blockWidth*.5,this.panelY+100+r*this.blockHeight*.5,.5*this.blockWidth,.5*this.blockHeight,this.colors[o])}}},{key:"renderBlock",value:function(e,t,i,n,l){this.ctx.fillStyle=l,this.ctx.strokeStyle="black",this.ctx.lineWidth=2,this.ctx.fillRect(e,t,i,n),this.ctx.strokeRect(e,t,i,n)}}])&&o(t.prototype,i),n&&o(t,n),e}();c.extend=c.prototype.extend=function(e,t){if("object"===s(e)&&"object"===s(t))for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};var h=document.querySelector("#root"),a=new r,f=new c(h,480,470,20,10);window.game=a,window.view=f,document.addEventListener("keydown",(function(e){switch(e.keyCode){case 37:a.movePieceLeft(),f.renderMainScreen(a.getState());break;case 38:a.rotatePiece(),f.renderMainScreen(a.getState());break;case 39:a.movePieceRight(),f.renderMainScreen(a.getState());break;case 40:a.movePieceDown(),f.renderMainScreen(a.getState())}}),!1),console.log(a),console.log(f)}]);
//# sourceMappingURL=core-tetris.js.map